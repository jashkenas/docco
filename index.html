<!DOCTYPE html>  <html> <head>   <title>docco.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="resources/docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               docco.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>Docco</strong> is a quick-and-dirty, hundred-line-long, literate-programming-style
documentation generator. It produces HTML that displays your comments
alongside your code. Comments are passed through
<a href="http://daringfireball.net/projects/markdown/syntax">Markdown</a>, and code is
passed through <a href="http://pygments.org/">Pygments</a> syntax highlighting.
This page is the result of running Docco against its own source file.</p>

<p>If you install Docco, you can run it from the command-line:</p>

<pre><code>docco src/*.coffee
</code></pre>

<p>...will generate linked HTML documentation for the named source files, saving
it into a <code>docs</code> folder.</p>

<p>The <a href="http://github.com/jashkenas/docco">source for Docco</a> is available on
GitHub, and released under the MIT license.</p>

<p>To install Docco, first make sure you have <a href="http://nodejs.org/">Node.js</a>,
<a href="http://pygments.org/">Pygments</a> (install the latest dev version of Pygments
from <a href="http://dev.pocoo.org/hg/pygments-main">its Mercurial repo</a>), and
<a href="http://coffeescript.org/">CoffeeScript</a>. Then, with NPM:</p>

<pre><code>sudo npm install docco
</code></pre>

<p>If <strong>Node.js</strong> doesn't run on your platform, or you'd prefer a more convenient
package, get <a href="http://rtomayko.github.com/rocco/">Rocco</a>, the Ruby port that's
available as a gem. If you're writing shell scripts, try
<a href="http://rtomayko.github.com/shocco/">Shocco</a>, a port for the <strong>POSIX shell</strong>.
Both are by <a href="http://github.com/rtomayko">Ryan Tomayko</a>. If Python's more
your speed, take a look at <a href="http://github.com/fitzgen">Nick Fitzgerald</a>'s
<a href="http://fitzgen.github.com/pycco/">Pycco</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>Main Documentation Generation Functions</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Processes the command line arguments, returns a hash with options and an
array of positional arguments for the source files. This allows the user to
pass some flags from the command line rather than modifying the file
everytime.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">parse_args</span> <span class="o">=</span> <span class="o">-&gt;</span>
  <span class="nx">opts</span>    <span class="o">=</span> <span class="p">{}</span>
  <span class="nx">sources</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="nx">args</span>    <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">ARGV</span>
  <span class="k">while</span> <span class="nx">arg</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>When we see a command line flag, do some slight processing on it, by
removing the preceding dashes first, and then grabbing the value it
refers to.</p>

<p>We finish by sticking the arg=value pair in the <code>opts</code> object. Note
that no processing is done on the argument's value. We assume all of
them to be plain strings.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="sr">/^--?/</span><span class="p">.</span><span class="nx">test</span> <span class="nx">arg</span>
      <span class="nx">arg</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">replace</span> <span class="o">/^--?</span><span class="err">/, &#39;&#39;</span>
      <span class="nx">opts</span><span class="p">[</span><span class="nx">arg</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>But if we don't get a command line flag, we just put the argument in
the sources list.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span>
      <span class="nx">sources</span><span class="p">.</span><span class="nx">push</span> <span class="nx">arg</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>And after all this small processing is done, we return an Array where the
first element is the <code>opts</code> object, and the second is the sources list.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">[</span><span class="nx">opts</span><span class="p">,</span> <span class="nx">sources</span><span class="p">.</span><span class="nx">sort</span><span class="p">()]</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Generate the documentation for a source file by reading it in, splitting it
up into comment/code sections, highlighting them for the appropriate language,
and merging them into an HTML template.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">generate_documentation</span> <span class="o">=</span> <span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span> <span class="nx">source</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">throw</span> <span class="nx">error</span> <span class="k">if</span> <span class="nx">error</span>
    <span class="nx">sections</span> <span class="o">=</span> <span class="nx">parse</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">code</span>
    <span class="nx">highlight</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">sections</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">generate_html</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">sections</span>
      <span class="nx">callback</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Given a string of source code, parse out each comment and the code that
follows it, and create an individual <strong>section</strong> for it.
Sections take the form:</p>

<pre><code>{
  docs_text: ...
  docs_html: ...
  code_text: ...
  code_html: ...
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">parse</span> <span class="o">=</span> <span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">save</span> <span class="o">=</span> <span class="p">(</span><span class="nx">docs</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span> <span class="nv">docs_text: </span><span class="nx">docs</span><span class="p">,</span> <span class="nv">code_text: </span><span class="nx">code</span>

  <span class="nx">should_ignore</span> <span class="o">=</span> <span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">filter</span> <span class="k">in</span> <span class="nx">language</span><span class="p">.</span><span class="nx">ignore</span>
      <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span>

  <span class="nx">filter</span> <span class="o">=</span> <span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">filter</span> <span class="k">in</span> <span class="nx">language</span><span class="p">.</span><span class="nx">filters</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">exec</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">test</span>
        <span class="nx">code</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">code</span> <span class="o">=</span> <span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nx">code</span>

  <span class="nx">sections</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="nx">language</span> <span class="o">=</span> <span class="nx">get_language</span> <span class="nx">source</span>
  <span class="nx">has_code</span> <span class="o">=</span> <span class="nx">docs_text</span> <span class="o">=</span> <span class="nx">code_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  <span class="nx">comment</span>  <span class="o">=</span> <span class="nx">language</span><span class="p">.</span><span class="nx">comment_matcher</span>
  <span class="nx">lines</span>    <span class="o">=</span> <span class="p">(</span><span class="nx">filter</span> <span class="nx">code</span><span class="p">).</span><span class="nx">split</span> <span class="s1">&#39;\n&#39;</span>

  <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">lines</span>
    <span class="k">if</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">comment</span><span class="p">)</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">should_ignore</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">has_code</span>
        <span class="nx">save</span> <span class="nx">docs_text</span><span class="p">,</span> <span class="nx">code_text</span>
        <span class="nx">has_code</span> <span class="o">=</span> <span class="nx">docs_text</span> <span class="o">=</span> <span class="nx">code_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
      <span class="nx">docs_text</span> <span class="o">+=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">comment</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span>
    <span class="k">else</span>
      <span class="nx">has_code</span> <span class="o">=</span> <span class="kc">yes</span>
      <span class="nx">code_text</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span>
  <span class="nx">save</span> <span class="nx">docs_text</span><span class="p">,</span> <span class="nx">code_text</span>
  <span class="nx">sections</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Highlights a single chunk of CoffeeScript code, using <strong>Pygments</strong> over stdio,
and runs the text of its corresponding comment through <strong>Markdown</strong>, using the
<strong>Github-flavored-Markdown</strong> modification of
<a href="http://attacklab.net/showdown/">Showdown.js</a>.</p>

<p>We process the entire file in a single call to Pygments by inserting little
marker comments between each section and then splitting the result string
wherever our markers occur.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">highlight</span> <span class="o">=</span> <span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">sections</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">language</span> <span class="o">=</span> <span class="nx">get_language</span> <span class="nx">source</span>
  <span class="nx">pygments</span> <span class="o">=</span> <span class="nx">spawn</span> <span class="s1">&#39;pygmentize&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="nx">language</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;-O&#39;</span><span class="p">,</span> <span class="s1">&#39;encoding=utf-8&#39;</span><span class="p">]</span>
  <span class="nx">output</span>   <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  <span class="nx">pygments</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">addListener</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span>  <span class="p">(</span><span class="nx">error</span><span class="p">)</span>  <span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="nx">error</span> <span class="k">if</span> <span class="nx">error</span>
  <span class="nx">pygments</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">addListener</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nx">result</span> <span class="k">if</span> <span class="nx">result</span>
  <span class="nx">pygments</span><span class="p">.</span><span class="nx">addListener</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
    <span class="nx">output</span> <span class="o">=</span> <span class="nx">output</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">highlight_start</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">highlight_end</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nx">fragments</span> <span class="o">=</span> <span class="nx">output</span><span class="p">.</span><span class="nx">split</span> <span class="nx">language</span><span class="p">.</span><span class="nx">divider_html</span>
    <span class="k">for</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">sections</span>
      <span class="nx">section</span><span class="p">.</span><span class="nx">code_html</span> <span class="o">=</span> <span class="nx">highlight_start</span> <span class="o">+</span> <span class="nx">fragments</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">highlight_end</span>
      <span class="nx">section</span><span class="p">.</span><span class="nx">docs_html</span> <span class="o">=</span> <span class="nx">showdown</span><span class="p">.</span><span class="nx">makeHtml</span> <span class="nx">section</span><span class="p">.</span><span class="nx">docs_text</span>
    <span class="nx">callback</span><span class="p">()</span>

  <span class="nx">sections_code</span> <span class="o">=</span> <span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">code_text</span> <span class="k">for</span> <span class="nx">section</span> <span class="k">in</span> <span class="nx">sections</span><span class="p">)</span>
  <span class="nx">pygments</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">sections_code</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">divider_text</span><span class="p">))</span>
  <span class="nx">pygments</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Once all of the code is finished highlighting, we can generate the HTML file
and write out the documentation. Pass the completed sections into the template
found in <code>resources/docco.jst</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">generate_html</span> <span class="o">=</span> <span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">sections</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">title</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span> <span class="nx">source</span>
  <span class="nx">dest</span>  <span class="o">=</span> <span class="nx">destination</span> <span class="nx">source</span>
  <span class="nx">html</span>  <span class="o">=</span> <span class="nx">docco_template</span> <span class="p">{</span>
    <span class="nv">title: </span>      <span class="nx">title</span>
    <span class="nv">sections: </span>   <span class="nx">sections</span>
    <span class="nv">sources: </span>    <span class="nx">sources</span>
    <span class="nv">path: </span>       <span class="nx">path</span>
    <span class="nv">destination: </span><span class="nx">destination</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s2">&quot;docco: #{source} -&gt; #{dest}&quot;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span> <span class="nx">dest</span><span class="p">,</span> <span class="nx">html</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>Helpers &amp; Setup</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Require our external dependencies, including <strong>Showdown.js</strong>
(the JavaScript implementation of Markdown).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">fs</span>       <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;fs&#39;</span>
<span class="nx">path</span>     <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;path&#39;</span>
<span class="nx">showdown</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./../vendor/showdown&#39;</span><span class="p">).</span><span class="nx">Showdown</span>
<span class="p">{</span><span class="nx">spawn</span><span class="p">,</span> <span class="nx">exec</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;child_process&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Takes a quick peak at the arguments in the command line, grabs any flag that
has been passed, so we can use it for overriding Docco's defaults, and use
everything else as the actual source files.</p>

<p>Accepted command line options are:</p>

<pre><code>--css       the stylesheet to use for the documentation
--template  the template to use for the documentation
--output    the directory to save the documentation
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">[</span><span class="nx">opts</span><span class="p">,</span> <span class="nx">sources</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parse_args</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Build out the appropriate matchers and delimiters for each language.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">languages</span> <span class="o">=</span> <span class="p">{}</span>
<span class="nx">deflang</span>   <span class="o">=</span> <span class="p">(</span><span class="nx">ext</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">symbol</span><span class="p">,</span> <span class="nx">ignore</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">filters</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span>
  <span class="nx">languages</span><span class="p">[</span><span class="nx">ext</span><span class="p">]</span> <span class="o">=</span>
    <span class="nv">name: </span>  <span class="nx">name</span>
    <span class="nv">symbol: </span><span class="nx">symbol</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Does the line begin with a comment?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">comment_matcher: </span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^\\s*&#39;</span> <span class="o">+</span> <span class="nx">symbol</span> <span class="o">+</span> <span class="s1">&#39;\\s?&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>By default, ignore
<a href="http://en.wikipedia.org/wiki/Shebang_(Unix">hashbangs</a>)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ignore: </span><span class="p">[</span><span class="k">new</span> <span class="nb">RegExp</span> <span class="s1">&#39;(^#![/])&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">ignore</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>A list of filters to pass the source code through before we move onto
extracting the comments and source from it. Can be used to filter
multiline comments and such.</p>

<p>Accepts either a function or a regexp, which will have the match replaced
by an empty string.</p>

<p>By default, all lines containing only comment symbols, where these
symbols are repeated at least once, are ignored.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">filters: </span><span class="p">[</span><span class="k">new</span> <span class="nb">RegExp</span> <span class="s1">&#39;(^\\s*&#39;</span> <span class="o">+</span> <span class="nx">symbol</span> <span class="o">+</span> <span class="s1">&#39;{2,}\\s*$)&#39;</span><span class="p">,</span><span class="s1">&#39;mg&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">filters</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>The dividing token we feed into Pygments, to delimit the boundaries
between sections.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">divider_text: </span><span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">symbol</span> <span class="o">+</span> <span class="s1">&#39;DIVIDER\n&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The mirror of <code>divider_text</code> that we expect Pygments to return. We can
split on this to recover the original sections.
Note: the class is "c" for Python and "c1" for the other languages</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">divider_html: </span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;\\n*&lt;span class=&quot;c1?&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">symbol</span> <span class="o">+</span>
                             <span class="s1">&#39;DIVIDER&lt;\\/span&gt;\\n*&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>A list of the languages that Docco supports, mapping the file extension to
the name of the Pygments lexer and the symbol that indicates a comment. To
add another language to Docco's repertoire, add it here.</p>

<p>For CoffeeScript, we also ignore string interpolations (#{var}) and here
comments.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">deflang</span> <span class="s1">&#39;.coffee&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;coffee-script&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;#&#39;</span>
      <span class="p">,</span> <span class="p">[</span><span class="sr">/^\s*\#\{/</span><span class="p">]</span>
      <span class="p">,</span> <span class="p">[</span><span class="sr">/^\s*\#{3}(?!\#)[\x00-\xFF]+?\#{3}/m</span><span class="p">]</span> <span class="c1"># here comment</span>

<span class="nx">deflang</span> <span class="s1">&#39;.js&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;javascript&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;//&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>iirc, Ruby also uses the same string interpolations, but I don't know the
language. Included here for the sake of it though.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">deflang</span> <span class="s1">&#39;.rb&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;ruby&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;#&#39;</span>
      <span class="p">,</span> <span class="p">[</span><span class="sr">/\s*\#\{/</span><span class="p">]</span>

<span class="nx">deflang</span> <span class="s1">&#39;.py&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;python&#39;</span>
      <span class="p">,</span> <span class="s1">&#39;#&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Get the current language we're documenting, based on the extension.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">get_language</span> <span class="o">=</span> <span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">languages</span><span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">source</span><span class="p">)]</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Compute the destination HTML path for an input source file path. If the source
is <code>lib/example.coffee</code>, the HTML will be at <code>docs/example.html</code></p>

<p><code>docs/</code> is the default output directory, however the user can specify any
other directory by providing a <code>--output</code> commandline flag.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">doc_dir</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">or</span> <span class="s1">&#39;docs/&#39;</span>
<span class="nx">destination</span> <span class="o">=</span> <span class="p">(</span><span class="nx">filepath</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">doc_dir</span> <span class="o">+</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filepath</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filepath</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Ensure that the destination directory exists.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">ensure_directory</span> <span class="o">=</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">exec</span> <span class="s2">&quot;mkdir -p #{doc_dir}&quot;</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="nx">callback</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Micro-templating, originally by John Resig, borrowed by way of
<a href="http://documentcloud.github.com/underscore/">Underscore.js</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">template</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">new</span> <span class="nb">Function</span> <span class="s1">&#39;obj&#39;</span><span class="p">,</span>
    <span class="s1">&#39;var p=[],print=function(){p.push.apply(p,arguments);};&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;with(obj){p.push(\&#39;&#39;</span> <span class="o">+</span>
    <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\r\t\n]/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;(?=[^&lt;]*%&gt;)/g</span><span class="p">,</span><span class="s2">&quot;\t&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\\&#39;&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\t&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;%=(.+?)%&gt;/g</span><span class="p">,</span> <span class="s2">&quot;&#39;,$1,&#39;&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&lt;%&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&#39;);&quot;</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;%&gt;&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;p.push(&#39;&quot;</span><span class="p">)</span> <span class="o">+</span>
       <span class="s2">&quot;&#39;);}return p.join(&#39;&#39;);&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Create the template that we will use to generate the Docco HTML page.</p>

<p>By default Docco will use the built-in template, however you can overwrite
this by just passing <code>--template</code> in the command line rather than changing
the default one.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">template_path</span>  <span class="o">=</span> <span class="nx">opts</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span> <span class="o">or</span> <span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/../resources/docco.jst&#39;</span><span class="p">)</span>
<span class="nx">docco_template</span> <span class="o">=</span> <span class="nx">template</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">template_path</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>The CSS styles we'd like to apply to the documentation.</p>

<p>By default Docco will use the built-in stylesheet, however you can overwrite
this by just passing <code>--css</code> in the command line rather than changing the
default one.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">css_path</span>     <span class="o">=</span> <span class="nx">opts</span><span class="p">[</span><span class="s1">&#39;css&#39;</span><span class="p">]</span> <span class="o">or</span> <span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/../resources/resources/docco.css&#39;</span><span class="p">)</span>
<span class="nx">docco_styles</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">css_path</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>The start of each Pygments highlight block.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">highlight_start</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>The end of each Pygments highlight block.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">highlight_end</span>   <span class="o">=</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/div&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Run the script and for each source file passed in as an argument.
generates the documentation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="nx">sources</span><span class="p">.</span><span class="nx">length</span>
  <span class="nx">ensure_directory</span> <span class="o">-&gt;</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span> <span class="s2">&quot;#{doc_dir}resources/docco.css&quot;</span><span class="p">,</span> <span class="nx">docco_styles</span>
    <span class="nx">next_file</span> <span class="o">=</span> <span class="o">-&gt;</span>
      <span class="nx">generate_documentation</span> <span class="nx">sources</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span> <span class="nx">next_file</span> <span class="k">if</span> <span class="nx">sources</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">next_file</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 